# ğŸš€ **CRYPTO QUANT LAB â€” FULL PROJECT DEFINITION (GROK-READY MASTER SPEC)**

### *Unified spec for the entire system: engine, indicators, strategies, backtester, portfolio mode, scanner, and live bot.*

---

# 0. **Purpose of the System**

The project is a **modular quantitative trading research lab** for crypto assets, capable of:

1. Ingesting & normalizing OHLCV data
2. Computing indicators & regimes
3. Loading strategies from JSON (SDL â€” Strategy Definition Language)
4. Running backtests with long/short logic
5. Logging trades + equity curves
6. Running portfolio-wide tests
7. Operating a real-time *paper bot*
8. Integrating a 3-stage *market scanner* for volume-driven signal discovery

The system emphasizes:
â€¢ **Deterministic results**
â€¢ **Decoupled modules**
â€¢ **Pluggable strategies**
â€¢ **Regime-aware routing**
â€¢ **Minimal data movement**
â€¢ **Fast incremental updates**

Everything is designed so future AI agents can extend the project without global rewrites.

---

# 1. **Project Folder Layout**

```
project_root/
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ indicators.py
â”‚   â”œâ”€â”€ engine.py
â”‚   â”œâ”€â”€ backtester.py
â”‚   â”œâ”€â”€ strategy_loader.py
â”‚   â””â”€â”€ regime_router.py        # added in Phase 2
â”‚
â”œâ”€â”€ strategies/
â”‚   â”œâ”€â”€ trend_macd.json
â”‚   â”œâ”€â”€ range_rsi_bb.json
â”‚   â””â”€â”€ (any other SDL strategies)
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ BTCUSDT_1h.csv
â”‚   â”œâ”€â”€ XRPUSDT_1h.csv
â”‚   â””â”€â”€ manifest.json
â”‚
â”œâ”€â”€ results/
â”‚   â””â”€â”€ (all trade logs generated by backtests)
â”‚
â”œâ”€â”€ backtester_settings.json
â”œâ”€â”€ backtester.py                # runnable CLI front-end
â”œâ”€â”€ getdata.py                   # standalone GUI for data downloading
â”œâ”€â”€ scanner/                     # Phase 8 (market scanner)
â”‚    â”œâ”€â”€ scanner_core.py
â”‚    â”œâ”€â”€ level0_universe.py
â”‚    â”œâ”€â”€ level1_regimes.py
â”‚    â”œâ”€â”€ level2_signals.py
â”‚    â”œâ”€â”€ scheduler.py
â”‚    â””â”€â”€ ...
â”‚
â””â”€â”€ live_paper_bot.py            # real-time bot using websockets
```

---

# 2. **Core Subsystems (High-Level)**

## 2.1 Indicator Engine (`core/indicators.py`)

Computes all TA indicators and assigns regimes:

* MACD fast/slow/signal
* EMA150
* SMA50
* ADX +DI / -DI
* RSI
* Bollinger Bands
* Volume Z-score (20-period lookback)
* Regime classification:

  * `trending_up`
  * `trending_down`
  * `ranging`
    (using minimum-duration smoothing)

Output: dataframe with all computed columns.

---

## 2.2 Strategy Loader (`core/strategy_loader.py`)

Loads strategy definitions from JSON (Strategy Definition Language).

SDL fields:

```json
{
  "name": "...",
  "regime": "trending|trending_up|trending_down|ranging|both",
  "direction": "long|short|both",
  "entry": { "conditions": [ ... ] },
  "exit": {
    "stop_loss": float,
    "take_profit": float,
    "partial_exit": float,
    "signal_exit": [ ... ]
  },
  "risk": {
    "sizing": "fixed_usd",
    "max_exposure_usd": float
  }
}
```

Supports:

* MACD cross
* ADX threshold
* RSI thresholds
* Price above/below EMA
* Bollinger band interactions
* Volume Z-score triggers

---

## 2.3 Dual-Regime Router (Phase 2)

Routes active strategy based on regime:

```
if trending_up â†’ use trend_macd.json  
if trending_down â†’ use trend_macd.json (short side)  
if ranging â†’ use range_rsi_bb.json  
```

---

## 2.4 Backtest Engine (`core/engine.py`)

Handles:

* Entries
* Long/short
* Partial exits
* Fees
* ATR/stop-loss
* Exposure limits
* Equity curve tracking
* Trade MAE/MFE
* Proper final close

Input: dataframe + mode + strategy name  
Output: summary + list of `Trade` namedtuples.

---

## 2.5 Backtester CLI (`backtester.py`)

User-facing command-line program:

* Reads `backtester_settings.json`
* Loads the CSV from `data/`
* Applies indicators
* Runs `engine.run_backtest()`
* Saves trades to `results/`

Supports CLI overrides:

```
--pair BTCUSDT
--interval 1h
--strategy trend_macd
--mode Aggressive
--max-candles 3000
```

---

## 2.6 Portfolio Mode (Phase 5)

* Iterates across all pairs in `manifest.json`
* Runs fast backtests on each
* Writes `summary.csv` with:

```
pair, return_pct, max_dd, trades, sharpe, winrate, ...
```

---

## 2.7 Live Paper Bot (Phase 7)

* MEXC WebSocket stream (1h candles)
* Incremental indicator updates
* Incremental regime detection
* Reuses backtest engine logic
* Tracks open positions + equity
* Console & optional GUI dashboard

---

# 3. **Market Scanner System (Multi-Stage)**

*(Integrated after core backtester is stable)*

The scanner runs continuously and determines *which assets deserve attention*.

---

## 3.1 Scanner Philosophy

Volume spike â†’ attention â†’ regime â†’ signal â†’ execution.

Scanner is tiered to minimize CPU usage across ~3,000 assets.

---

## 3.2 Levels Summary

### **Level 0 â€” Universe Scan (All pairs hourly)**

Cheap computation on 1h timeframe:

* log(volume)
* rolling mean
* rolling std
* Z-score
* volume acceleration

Triggers:

* Z â‰¥ 3 â†’ promote to Level 1
* Z â‰¥ 4â€“6 â†’ immediate Level 2

---

### **Level 1 â€” Regime Classification (15m)**

Only for pairs promoted from L0.

Compute:

* MACD
* ADX
* RSI
* EMA150
* Bollinger bands
* Regime assignment

Filter:

* Remove dead assets
* Keep trending or aggressively ranging assets

Triggers:

* sustained trending â†’ escalate to Level 2

---

### **Level 2 â€” Signal Detection (1â€“5 min)**

Real strategy signals:

* entry conditions from SDL
* candle body expansion
* volatility expansion
* short-term volume bursts

If a valid signal fires â†’ send to bot or alert system.

---

# 4. **Phased Development Plan**

Eight phases, each with mini-phases & acceptance criteria.

### **Phase 0: Refactor to Pure Engine**

Move logic to `core/`.  
Backtester becomes a thin client.

### **Phase 1: Strategy Definition Language (SDL)**

All strategies stored in JSON.  
`engine` reads from `core/strategy_loader.py`.

### **Phase 2: Dual-Regime Router + Shorting**

Trend vs. range strategies.  
Short logic enabled.

### **Phase 3: Trade Logging + Results Object**

Namedtuple + CSV export.

### **Phase 4: Equity Curve Visualization**

Matplotlib charts + regime shading.

### **Phase 5: Portfolio Mode**

Backtest entire market quickly.

### **Phase 6: Risk Model Upgrade**

% equity sizing  
ATR stops  
Dynamic exposure

### **Phase 7: Live Paper Bot**

Full real-time engine using websockets.

### **Phase 8: Market Scanner Subsystem**

Tiered L0/L1/L2 architecture  
Volume Z-score detection  
Real-time alerts

---

# 5. **Data Flow Overview**

```
CSV â†’ indicators â†’ regime â†’ strategy loader â†’ engine â†’ trades + equity â†’ results/
```

Scanner data flow:

```
Exchange API â†’ L0 volume analysis
                â†’ promoted assets
                     â†’ L1 regime classification
                          â†’ eligible assets
                               â†’ L2 signal detection
                                    â†’ engine entry logic
```

---

# 6. **External Dependencies**

* Python 3.10+
* pandas
* numpy
* matplotlib
* requests (for getdata.py)
* tkinter (GUI for data downloader)
* websockets (for live bot)
* decimal (for precise PnL)

---

# 7. **Key Design Goals**

* Deterministic & reproducible
* Strategy-agnostic engine
* Minimal coupling
* No hardcoded indicators in strategies
* JSON-defined strategies
* Regime-aware routing
* High performance (delta updates)
* Handles thousands of assets (scanner)
* AI-extensible
* Clear boundaries between modules

---

# âœ”ï¸ **This is the complete â€œMaster Specâ€ suitable for Grok**  
**Paste it into a Grok Project as:**  
**â€œCRYPTO QUANT LAB â€” Project Specificationâ€**