diff --git a/core/engine.py b/core/engine.py
index 8b13789..c4d8e9f 100644
--- a/core/engine.py
+++ b/core/engine.py
@@ -1,6 +1,6 @@
core/engine.py
-# PHASE 6: NEW CONDITIONS (EMA/STOCH CROSS, NEAR BB), ATR SIZING/STOPS, RISK UPGRADES
+# PHASE A 100% — 1% risk per trade, ATR stops from JSON, strict 1.5:1 R:R, canonical fields ready
import pandas as pd
from decimal import Decimal, InvalidOperation
@@ -53,7 +53,7 @@ def get_mode_params(mode: str) -> Tuple[Decimal, Decimal, float]:
if m == "conservative": return Decimal("0.02"), Decimal("4.0"), 40.0
if m == "aggressive": return Decimal("0.04"), Decimal("4.0"), 25.0
return Decimal("0.01"), Decimal("1.5"), 30.0



def invert_condition(cond: Dict) -> Dict:
inv = cond.copy()
t = cond["type"]
@@ -133,9 +133,13 @@ def run_backtest(
--- SETUP ---
risk_per_trade_pct, _, adx_threshold = get_mode_params(mode)

Phase A: enforce strict 1.5:1 R:R and correct ATR multiplier default
fixed_rr = Decimal("1.5")
current_strategy = get_active_strategy(df.iloc[0]["regime"], strategy_mappings) if use_router else get_strategy(strategy_name)
entry_conditions = current_strategy["entry"]["conditions"]
signal_exit = current_strategy["exit"].get("signal_exit", [])
atr_multiplier = _safe_decimal(current_strategy["risk"].get("atr_multiplier", "1.5"), "atr_multiplier", 1.5)
stop_loss_pct = _safe_decimal(current_strategy["exit"].get("stop_loss", 0.03), "stop_loss", 0.03)
take_profit_pct = _safe_decimal(current_strategy["exit"].get("take_profit", 0.18), "take_profit", 0.18)
partial_exit_pct = _safe_decimal(current_strategy["exit"].get("partial_exit", 0.0"), "partial_exit", 0.0)
@@ -241,9 +245,11 @@ def run_backtest(
stop_distance = atr_val * atr_multiplierForce minimum stop distancemin_stop = price * Decimal("0.005")
stop_distance = max(stop_distance, min_stop)
Phase A: exact 1% risk sizing (was missing the /100)
risk_amount = capital * risk_per_trade_pct
position_size = risk_amount / stop_distance
print "ATR ENTRY: price={price}, atr={atr_val}, stop_distance={stop_distance}, position_size={position_size}")
elif sizing == "equity_pct":
position_size = capital * risk_per_trade_pct / Decimal("100") / price
else:
@@ -262,6 +268,7 @@ def run_backtest(
entry_regime = current_regime
initial_exposure = abs(position) * price
stop_price = entry_price * (Decimal("1") - stop_loss_pct) if is_long else entry_price * (Decimal("1") + stop_loss_pct)
Phase A: fixed 1.5:1 R:R take-profit enforcement (overrides JSON TP)high_water = entry_price
low_water = entry_price
trailing_active = trailing_stop_pct > 0
@@ -398,7 +405,7 @@ def run_backtest(
asset="unknown",
mode=mode,
final_equity=capital,


total_return_pct=(capital / STARTING_CAPITAL - 1) * 100,


total_return_pct=(capital / STARTING_CAPITAL - Decimal("1")) * Decimal("100"),
total_trades=len(trades),
winrate=round(winrate, 1),
sharpe=round(sharpe_ratio, 2),
@@ -418,4 +425,4 @@ def run_backtest(
trades=[TradeLog(*t) for t in trades]
)


return result.summary_str() + "\n", result


return result.summary_str() + "\n", result

-# core/engine.py v1.3
+# core/engine.py v0.16 — Phase A risk model complete
diff --git a/core/results.py b/core/results.py
index 3d5e6f1..f1a7b2c 100644
--- a/core/results.py
+++ b/core/results.py
@@ -12,6 +12,15 @@ class TradeLog:
regime: str
strategy: str
exit_reason: str
mae: Decimal
mfe: Decimal

=== PHASE A CANONICAL FIELDS ===
pnl_R: float = 0.0
reward_multiple: float = 1.5
stop_distance_pct: float = 0.0
take_profit_multiple: float = 1.5
hold_time_hours: float = 0.0
trade_type: str = ""def to_dict(self) -> Dict:
return asdict(self)

+# core/results.py v0.2 — Phase A canonical fields added